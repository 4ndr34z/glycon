{% extends "base.html" %}

{% block content %}
<div class="container-fluid mt-5">
    <div class="card shadow-sm">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-key me-2"></i>Credentials</h5>
            <div class="d-flex gap-2">
                <input type="text" id="credentialsSearch" class="form-control form-control-sm" placeholder="Search credentials..." style="width: 200px;">
                <select id="credentialsBrowserFilter" class="form-select form-select-sm" style="width: 150px;">
                    <option value="">All Browsers</option>
                    <option value="chrome">Chrome</option>
                    <option value="firefox">Firefox</option>
                    <option value="edge">Edge</option>
                    <option value="safari">Safari</option>
                </select>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover resizable-table" id="credentialsTable">
                    <thead class="table-dark">
                        <tr>
                            <th class="sortable" data-column="browser">Browser <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                            <th class="sortable" data-column="url">URL <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                            <th class="sortable" data-column="username">Username <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                            <th class="sortable" data-column="password">Password <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                            <th class="sortable" data-column="agent_id">Agent <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                            <th class="sortable" data-column="timestamp">Timestamp <i class="fas fa-sort"></i></th>
                        </tr>
                    </thead>
                    <tbody id="credentialsTableBody">
                        {% for cred in credentials %}
                        <tr>
                            <td><span class="badge bg-primary">{{ cred.browser|capitalize }}</span></td>
                            <td>
                                <a href="{{ cred.url }}" target="_blank" class="text-decoration-none">
                                    {{ cred.url|truncate(40) }}
                                </a>
                            </td>
                            <td>{{ cred.username }}</td>
                            <td>
                                <div class="input-group">
                                    <input type="password" class="form-control" value="{{ cred.password }}" readonly id="pass-{{ cred.id }}">
                                    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('pass-{{ cred.id }}', this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </td>
                            <td>
                                <a href="{{ base_url }}{{ url_for('agent_detail', agent_id=cred.agent_id) }}" class="text-decoration-none">
                                    {{ cred.agent_id }}
                                </a>
                            </td>
                            <td>{{ cred.timestamp }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-3">
                <div>
                    <small class="text-muted">Showing <span id="credentialsCount">0</span> entries</small>
                </div>
                <nav aria-label="Credentials pagination">
                    <ul class="pagination pagination-sm mb-0" id="credentialsPagination">
                        <!-- Pagination will be generated here -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Browser History Section -->
    <div class="card shadow-sm mt-4">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-history me-2"></i>Browser History</h5>
            <div class="d-flex gap-2">
                <input type="text" id="historySearch" class="form-control form-control-sm" placeholder="Search history..." style="width: 200px;">
                <select id="historyBrowserFilter" class="form-select form-select-sm" style="width: 150px;">
                    <option value="">All Browsers</option>
                    <option value="chrome">Chrome</option>
                    <option value="firefox">Firefox</option>
                    <option value="edge">Edge</option>
                    <option value="opera">Opera</option>
                </select>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover resizable-table" id="historyTable">
                    <thead class="table-dark">
                        <tr>
                            <th class="sortable" data-column="browser">Browser <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                            <th class="sortable" data-column="url">URL <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                            <th class="sortable" data-column="title">Title <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                            <th class="sortable" data-column="visit_count">Visit Count <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                            <th class="sortable" data-column="agent_id">Agent <i class="fas fa-sort"></i><div class="resize-handle"></div></th>
                            <th class="sortable" data-column="timestamp">Timestamp <i class="fas fa-sort"></i></th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <!-- History data will be loaded here -->
                    </tbody>
                </table>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-3">
                <div>
                    <small class="text-muted">Showing <span id="historyCount">0</span> entries</small>
                </div>
                <nav aria-label="History pagination">
                    <ul class="pagination pagination-sm mb-0" id="historyPagination">
                        <!-- Pagination will be generated here -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mt-4">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0"><i class="fas fa-cookie me-2"></i>Stolen Cookies</h5>
        </div>
        <div class="card-body">
            {% if cookies_data %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Browser</th>
                            <th>Agent</th>
                            <th>System Info</th>
                            <th>Timestamp</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cookie in cookies_data %}
                        <tr>
                            <td><span class="badge bg-primary">{{ cookie.browser|capitalize }}</span></td>
                            <td>
                                <a href="{{ base_url }}{{ url_for('agent_detail', agent_id=cookie.agent_id) }}" class="text-decoration-none">
                                    {{ cookie.agent_id }}
                                </a>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-info" data-bs-toggle="modal"
                                        data-bs-target="#systemInfoModal"
                                        data-info="{{ cookie.system_info|tojson|forceescape }}">
                                    View Info
                                </button>
                            </td>
                            <td>{{ cookie.timestamp }}</td>
                            <td>
                                <a href="{{ base_url }}{{ url_for('download_stolen_data', data_id=cookie.id) }}"
                                   class="btn btn-sm btn-success">
                                    <i class="fas fa-download"></i> Download
                                </a>
                                <button class="btn btn-sm btn-danger ms-2" onclick="deleteCookieData({{ cookie.id }})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info">No stolen cookie data available</div>
            {% endif %}
        </div>
    </div>
    
   <!-- System Info Modal -->
<div class="modal fade" id="systemInfoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">System Information</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="systemInfoContent">
                    <!-- System info will be inserted here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

</div>
{% endblock %}

{% block extra_js %}
<style>
.resizable-table th {
    position: relative;
    min-width: 50px;
    user-select: none;
}
.resizable-table th:not(:last-child) {
    border-right: 2px solid transparent;
}
.resizable-table th .resize-handle {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 5px;
    background: rgba(0,0,0,0.1);
    cursor: col-resize;
    opacity: 0;
    transition: opacity 0.2s;
}
.resizable-table th:hover .resize-handle {
    opacity: 1;
}
.resizable-table th.resizing .resize-handle {
    opacity: 1;
    background: rgba(0,0,0,0.3);
}
.resizable-table.resizing {
    user-select: none;
}
</style>
<script>
let credentialsData = [];
let historyData = [];
let currentCredentialsPage = 1;
let currentHistoryPage = 1;
let itemsPerPage = 25;
let credentialsSortColumn = 'timestamp';
let credentialsSortDirection = 'desc';
let historySortColumn = 'timestamp';
let historySortDirection = 'desc';

// Load data on page load
document.addEventListener('DOMContentLoaded', function() {
    loadCredentialsData();
    loadHistoryData();
});

// System info modal handler
document.getElementById('systemInfoModal').addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    const systemInfo = JSON.parse(button.getAttribute('data-info'));
    const modalBody = document.getElementById('systemInfoContent');

    // Clear previous content
    modalBody.innerHTML = '';

    if (!systemInfo || Object.keys(systemInfo).length === 0) {
        modalBody.innerHTML = '<div class="alert alert-info">No system information available</div>';
        return;
    }

    // Create the HTML structure for system info
    let html = `
        <div class="system-info-section">
            <h6><strong>Basic Information</strong></h6>
            <div class="row mb-3">
                <div class="col-md-6">
                    <p><strong>IP Address:</strong> ${systemInfo.ip_address || 'Unknown'}</p>
                    <p><strong>Location:</strong> ${systemInfo.location || 'Unknown'}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Username:</strong> ${systemInfo.username || 'Unknown'}</p>
                    <p><strong>Computer Name:</strong> ${systemInfo.computer_name || 'Unknown'}</p>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <p><strong>Windows Version:</strong> ${systemInfo.windows_version || 'Unknown'}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>User Agent:</strong> ${systemInfo.user_agent || 'Unknown'}</p>
                </div>
            </div>
    `;

    // Add domains if available
    if (systemInfo.unique_domains && systemInfo.unique_domains.length > 0) {
        html += `
            <hr>
            <h6><strong>Unique Domains (${systemInfo.browser || 'this browser'})</strong></h6>
            <ul class="domain-list">
                ${systemInfo.unique_domains.map(domain => `<li>${domain}</li>`).join('')}
            </ul>
        `;
    }

    if (systemInfo.all_domains && systemInfo.all_domains.length > 0) {
        html += `
            <hr>
            <h6><strong>All Collected Domains</strong></h6>
            <ul class="domain-list">
                ${systemInfo.all_domains.map(domain => `<li>${domain}</li>`).join('')}
            </ul>
        `;
    }

    html += `</div>`;

    // Add some basic styling
    html += `
        <style>
            .system-info-section {
                font-size: 14px;
            }
            .domain-list {
                max-height: 200px;
                overflow-y: auto;
                list-style-type: none;
                padding-left: 0;
            }
            .domain-list li {
                padding: 2px 0;
                border-bottom: 1px solid #eee;
            }
        </style>
    `;

    modalBody.innerHTML = html;
});

// Load credentials data from template
function loadCredentialsData() {
    const tbody = document.getElementById('credentialsTableBody');
    const rows = tbody.querySelectorAll('tr');
    credentialsData = Array.from(rows).map(row => {
        const cells = row.querySelectorAll('td');
        return {
            browser: cells[0].textContent.trim().toLowerCase(),
            url: cells[1].querySelector('a') ? cells[1].querySelector('a').href : cells[1].textContent.trim(),
            username: cells[2].textContent.trim(),
            password: cells[3].querySelector('input') ? cells[3].querySelector('input').value : cells[3].textContent.trim(),
            agent_id: cells[4].querySelector('a') ? cells[4].querySelector('a').href.split('/').pop() : cells[4].textContent.trim(),
            timestamp: cells[5].textContent.trim()
        };
    });
    renderCredentialsTable();
}

// Load history data from API
async function loadHistoryData() {
    try {
        const response = await fetch('/api/browser_history');
        const data = await response.json();

        if (data.status === 'success') {
            historyData = data.history;
            renderHistoryTable();
        } else {
            document.getElementById('historyTableBody').innerHTML =
                '<tr><td colspan="6" class="text-center text-muted">No browser history data available</td></tr>';
        }
    } catch (error) {
        console.error('Error loading history data:', error);
        document.getElementById('historyTableBody').innerHTML =
            '<tr><td colspan="6" class="text-center text-danger">Error loading history data</td></tr>';
    }
}

// Render credentials table with current filters and sorting
function renderCredentialsTable() {
    const tbody = document.getElementById('credentialsTableBody');
    const searchTerm = document.getElementById('credentialsSearch').value.toLowerCase();
    const browserFilter = document.getElementById('credentialsBrowserFilter').value;

    // Filter data
    let filteredData = credentialsData.filter(item => {
        const matchesSearch = !searchTerm ||
            item.url.toLowerCase().includes(searchTerm) ||
            item.username.toLowerCase().includes(searchTerm) ||
            item.browser.toLowerCase().includes(searchTerm);

        const matchesBrowser = !browserFilter ||
            item.browser.toLowerCase().includes(browserFilter.toLowerCase());

        return matchesSearch && matchesBrowser;
    });

    // Sort data
    filteredData.sort((a, b) => {
        let aVal = a[credentialsSortColumn];
        let bVal = b[credentialsSortColumn];

        if (typeof aVal === 'string') {
            aVal = aVal.toLowerCase();
            bVal = bVal.toLowerCase();
        }

        if (credentialsSortDirection === 'asc') {
            return aVal > bVal ? 1 : -1;
        } else {
            return aVal < bVal ? 1 : -1;
        }
    });

    // Paginate
    const totalItems = filteredData.length;
    const totalPages = Math.ceil(totalItems / itemsPerPage);
    const startIndex = (currentCredentialsPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const pageData = filteredData.slice(startIndex, endIndex);

    // Render table rows
    tbody.innerHTML = pageData.map(item => `
        <tr>
            <td><span class="badge bg-primary">${item.browser.charAt(0).toUpperCase() + item.browser.slice(1)}</span></td>
            <td>
                <a href="${item.url}" target="_blank" class="text-decoration-none" title="${item.url}">
                    ${item.url.length > 40 ? item.url.substring(0, 40) + '...' : item.url}
                </a>
            </td>
            <td>${item.username}</td>
            <td>
                <div class="input-group">
                    <input type="password" class="form-control" value="${item.password}" readonly id="pass-${item.agent_id}-${item.username.replace(/[^a-zA-Z0-9]/g, '')}">
                    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('pass-${item.agent_id}-${item.username.replace(/[^a-zA-Z0-9]/g, '')}', this)">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </td>
            <td>
                <a href="/agent/${item.agent_id}" class="text-decoration-none">
                    ${item.agent_id}
                </a>
            </td>
            <td>${item.timestamp}</td>
        </tr>
    `).join('');

    // Update pagination
    updateCredentialsPagination(totalPages, totalItems);
}

// Render history table with current filters and sorting
function renderHistoryTable() {
    const tbody = document.getElementById('historyTableBody');
    const searchTerm = document.getElementById('historySearch').value.toLowerCase();
    const browserFilter = document.getElementById('historyBrowserFilter').value;

    // Filter data
    let filteredData = historyData.filter(item => {
        const matchesSearch = !searchTerm ||
            item.url.toLowerCase().includes(searchTerm) ||
            item.title.toLowerCase().includes(searchTerm) ||
            item.browser.toLowerCase().includes(searchTerm);

        const matchesBrowser = !browserFilter ||
            item.browser.toLowerCase().includes(browserFilter.toLowerCase());

        return matchesSearch && matchesBrowser;
    });

    // Sort data
    filteredData.sort((a, b) => {
        let aVal = a[historySortColumn];
        let bVal = b[historySortColumn];

        if (typeof aVal === 'string') {
            aVal = aVal.toLowerCase();
            bVal = bVal.toLowerCase();
        }

        if (historySortDirection === 'asc') {
            return aVal > bVal ? 1 : -1;
        } else {
            return aVal < bVal ? 1 : -1;
        }
    });

    // Paginate
    const totalItems = filteredData.length;
    const totalPages = Math.ceil(totalItems / itemsPerPage);
    const startIndex = (currentHistoryPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const pageData = filteredData.slice(startIndex, endIndex);

    // Render table rows
    tbody.innerHTML = pageData.map(item => `
        <tr>
            <td><span class="badge bg-primary">${item.browser}</span></td>
            <td>
                <a href="${item.url}" target="_blank" class="text-decoration-none" title="${item.url}">
                    ${item.url.length > 50 ? item.url.substring(0, 50) + '...' : item.url}
                </a>
            </td>
            <td>${item.title || 'N/A'}</td>
            <td>${item.visit_count}</td>
            <td>
                <a href="/agent/${item.agent_id}" class="text-decoration-none">
                    ${item.agent_id}
                </a>
            </td>
            <td>${item.timestamp}</td>
        </tr>
    `).join('');

    // Update pagination
    updateHistoryPagination(totalPages, totalItems);
}

// Update credentials pagination controls
function updateCredentialsPagination(totalPages, totalItems) {
    const pagination = document.getElementById('credentialsPagination');
    const count = document.getElementById('credentialsCount');

    count.textContent = totalItems;

    let paginationHtml = '';

    if (totalPages > 1) {
        // Previous button
        paginationHtml += `<li class="page-item ${currentCredentialsPage === 1 ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="changeCredentialsPage(${currentCredentialsPage - 1})">Previous</a>
        </li>`;

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            if (i === currentCredentialsPage || i === 1 || i === totalPages ||
                (i >= currentCredentialsPage - 1 && i <= currentCredentialsPage + 1)) {
                paginationHtml += `<li class="page-item ${i === currentCredentialsPage ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="changeCredentialsPage(${i})">${i}</a>
                </li>`;
            } else if (i === currentCredentialsPage - 2 || i === currentCredentialsPage + 2) {
                paginationHtml += '<li class="page-item disabled"><span class="page-link">...</span></li>';
            }
        }

        // Next button
        paginationHtml += `<li class="page-item ${currentCredentialsPage === totalPages ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="changeCredentialsPage(${currentCredentialsPage + 1})">Next</a>
        </li>`;
    }

    pagination.innerHTML = paginationHtml;
}

// Update history pagination controls
function updateHistoryPagination(totalPages, totalItems) {
    const pagination = document.getElementById('historyPagination');
    const count = document.getElementById('historyCount');

    count.textContent = totalItems;

    let paginationHtml = '';

    if (totalPages > 1) {
        // Previous button
        paginationHtml += `<li class="page-item ${currentHistoryPage === 1 ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="changeHistoryPage(${currentHistoryPage - 1})">Previous</a>
        </li>`;

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            if (i === currentHistoryPage || i === 1 || i === totalPages ||
                (i >= currentHistoryPage - 1 && i <= currentHistoryPage + 1)) {
                paginationHtml += `<li class="page-item ${i === currentHistoryPage ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="changeHistoryPage(${i})">${i}</a>
                </li>`;
            } else if (i === currentHistoryPage - 2 || i === currentHistoryPage + 2) {
                paginationHtml += '<li class="page-item disabled"><span class="page-link">...</span></li>';
            }
        }

        // Next button
        paginationHtml += `<li class="page-item ${currentHistoryPage === totalPages ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="changeHistoryPage(${currentHistoryPage + 1})">Next</a>
        </li>`;
    }

    pagination.innerHTML = paginationHtml;
}

// Change credentials page
function changeCredentialsPage(page) {
    currentCredentialsPage = page;
    renderCredentialsTable();
}

// Change history page
function changeHistoryPage(page) {
    currentHistoryPage = page;
    renderHistoryTable();
}

// Sort table
document.addEventListener('click', function(e) {
    if (e.target.closest('.sortable')) {
        const column = e.target.closest('.sortable').dataset.column;
        const tableId = e.target.closest('table').id;

        if (tableId === 'credentialsTable') {
            if (credentialsSortColumn === column) {
                credentialsSortDirection = credentialsSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                credentialsSortColumn = column;
                credentialsSortDirection = 'asc';
            }

            // Update sort icons for credentials table
            document.querySelectorAll('#credentialsTable .sortable i').forEach(icon => {
                icon.className = 'fas fa-sort';
            });

            const icon = e.target.closest('.sortable').querySelector('i');
            icon.className = credentialsSortDirection === 'asc' ? 'fas fa-sort-up' : 'fas fa-sort-down';

            currentCredentialsPage = 1;
            renderCredentialsTable();
        } else if (tableId === 'historyTable') {
            if (historySortColumn === column) {
                historySortDirection = historySortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                historySortColumn = column;
                historySortDirection = 'asc';
            }

            // Update sort icons for history table
            document.querySelectorAll('#historyTable .sortable i').forEach(icon => {
                icon.className = 'fas fa-sort';
            });

            const icon = e.target.closest('.sortable').querySelector('i');
            icon.className = historySortDirection === 'asc' ? 'fas fa-sort-up' : 'fas fa-sort-down';

            currentHistoryPage = 1;
            renderHistoryTable();
        }
    }
});

// Search functionality
document.getElementById('credentialsSearch').addEventListener('input', function() {
    currentCredentialsPage = 1;
    renderCredentialsTable();
});

document.getElementById('historySearch').addEventListener('input', function() {
    currentHistoryPage = 1;
    renderHistoryTable();
});

// Browser filter
document.getElementById('credentialsBrowserFilter').addEventListener('change', function() {
    currentCredentialsPage = 1;
    renderCredentialsTable();
});

document.getElementById('historyBrowserFilter').addEventListener('change', function() {
    currentHistoryPage = 1;
    renderHistoryTable();
});

function deleteCookieData(dataId) {
    if (confirm('Are you sure you want to delete this cookie data?')) {
        fetch(`/api/stolen_data/${dataId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                location.reload();
            } else {
                alert('Failed to delete: ' + (data.message || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to delete cookie data');
        });
    }
}

function togglePassword(inputId, button) {
    const input = document.getElementById(inputId);
    if (input.type === "password") {
        input.type = "text";
        button.innerHTML = '<i class="fas fa-eye-slash"></i>';
    } else {
        input.type = "password";
        button.innerHTML = '<i class="fas fa-eye"></i>';
    }
}

// Column resizing functionality
let isResizing = false;
let currentResizer = null;
let startX = 0;
let startWidth = 0;

document.addEventListener('DOMContentLoaded', function() {
    // Add resize handles to table headers for both tables
    const tables = ['credentialsTable', 'historyTable'];
    tables.forEach(tableId => {
        const table = document.getElementById(tableId);
        const headers = table.querySelectorAll('th');

        headers.forEach((header, index) => {
            if (index < headers.length - 1) { // Don't add to last column
                const resizer = header.querySelector('.resize-handle');
                if (resizer) {
                    resizer.addEventListener('mousedown', function(e) {
                        isResizing = true;
                        currentResizer = resizer;
                        startX = e.clientX;
                        startWidth = header.offsetWidth;
                        table.classList.add('resizing');
                        header.classList.add('resizing');
                        e.preventDefault();
                    });
                }
            }
        });
    });
});

document.addEventListener('mousemove', function(e) {
    if (isResizing && currentResizer) {
        const header = currentResizer.parentElement;
        const newWidth = startWidth + (e.clientX - startX);
        if (newWidth > 50) { // Minimum width
            header.style.width = newWidth + 'px';
            header.style.minWidth = newWidth + 'px';
        }
    }
});

document.addEventListener('mouseup', function() {
    if (isResizing) {
        isResizing = false;
        if (currentResizer) {
            currentResizer.parentElement.classList.remove('resizing');
        }
        currentResizer = null;
        // Remove resizing class from both tables
        document.getElementById('credentialsTable').classList.remove('resizing');
        document.getElementById('historyTable').classList.remove('resizing');
    }
});
</script>
{% endblock %}
